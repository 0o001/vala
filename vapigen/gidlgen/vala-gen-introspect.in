#!/bin/sh

prefix=@prefix@
exec_prefix=@exec_prefix@
libdir=@libdir@
pkglibdir=${libdir}/vala

if [ $# -ne 2 ]
then
	echo "Usage: `basename $0` PKGNAME BASEPATH"
	exit 1
fi

PKGNAME=$1
PKGBASE=$2/$1
PKGPREFIX=`pkg-config --variable=prefix $PKGNAME`

PKGFILES=`cat $PKGBASE.files | sed -e "s@^@$PKGPREFIX/@"`

if [ -e $PKGBASE.excludes ]
then
	FILES=`find $PKGFILES -name "*.h" -or -name "*.so" | grep -v -f $PKGBASE.excludes`
else
	FILES=`find $PKGFILES -name "*.h" -or -name "*.so"`
fi

$pkglibdir/gen-introspect --namespace=`cat $PKGBASE.namespace` -U__GNUC__ `pkg-config --cflags $PKGNAME` $FILES > $PKGBASE.gi

